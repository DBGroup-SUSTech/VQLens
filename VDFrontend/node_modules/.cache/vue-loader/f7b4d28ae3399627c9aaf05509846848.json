{"remainingRequest":"/home/yansha/VDProject/VDFrontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/yansha/VDProject/VDFrontend/src/views/MainView/RightMainView/HistoryView.vue?vue&type=script&lang=js","dependencies":[{"path":"/home/yansha/VDProject/VDFrontend/src/views/MainView/RightMainView/HistoryView.vue","mtime":1744442733412},{"path":"/home/yansha/VDProject/VDFrontend/node_modules/cache-loader/dist/cjs.js","mtime":1735202380381},{"path":"/home/yansha/VDProject/VDFrontend/node_modules/babel-loader/lib/index.js","mtime":1735202380921},{"path":"/home/yansha/VDProject/VDFrontend/node_modules/babel-loader/lib/index.js","mtime":1735202380921},{"path":"/home/yansha/VDProject/VDFrontend/node_modules/cache-loader/dist/cjs.js","mtime":1735202380381},{"path":"/home/yansha/VDProject/VDFrontend/node_modules/vue-loader/lib/index.js","mtime":1735202381045}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgaW1wb3J0ICogYXMgZDMgZnJvbSAiZDMiOwogIGltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAidnVleCI7CiAgaW1wb3J0IGFwaSBmcm9tICJAL2FwaS9kYXRhIjsKICAKICBleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiTm9kZUxpbmtWaWV3IiwKICAgIGNvbXBvbmVudHM6IHt9LAogICAgZGF0YSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBub2RlbGlua2RhdGE6IHt9LAogICAgICAgIHN2Z1dpZHRoOiAwLCAgLy8g6aG16Z2i55qE5a695bqmCiAgICAgICAgc3ZnSGVpZ2h0OiAwLCAgIC8vIOmhtemdoumrmOW6pgogICAgICAgIHZlbG9jaXR5RGVjYXk6IDAuNiwKICAgICAgICB0aHVtYm5haWxXaWR0aDogMCwgLy8g57yp55Wl5Zu+5a695bqmCiAgICAgICAgdGh1bWJuYWlsSGVpZ2h0OiAwLCAvLyDnvKnnlaXlm77pq5jluqYKICAgICAgfTsKICAgIH0sCiAgICBtb3VudGVkKCkgewogICAgICB0aGlzLmdldFZpZXdTaXplKCk7CiAgICAgIHRoaXMubm9kZWxpbmtkYXRhID0gdGhpcy4kc3RvcmUuc3RhdGUuZGF0YU5vZGVMaW5rOwogICAgICBjb25zb2xlLmxvZygi6K+36L6T5Ye6IGxpbmsgZGF0YSDmnaXnnIvkuIDkuIvov57mjqXnur/nmoQgZGF0YSIsdGhpcy5ub2RlbGlua2RhdGEpOwogICAgICB0aGlzLmluaXRHcmFwaCh0aGlzLm5vZGVsaW5rZGF0YSk7CiAgICB9LAogICAgbWV0aG9kczogewogICAgICBnZXRWaWV3U2l6ZSgpIHsKICAgICAgICBjb25zdCBkYWcgPSB0aGlzLiRyZWZzLmRhZzsKICAgICAgICB0aGlzLnN2Z0hlaWdodCA9IGRhZy5jbGllbnRIZWlnaHQ7CiAgICAgICAgdGhpcy5zdmdXaWR0aCA9IGRhZy5jbGllbnRXaWR0aDsKICAgICAgICB0aGlzLnRodW1ibmFpbFdpZHRoID0gdGhpcy5zdmdXaWR0aCAvIDU7ICAvLyDnvKnnlaXlm77lrr3luqblkozpq5jluqbliIbliKvkuLrmlbTkuKpzdmcg55qEMS81CiAgICAgICAgdGhpcy50aHVtYm5haWxIZWlnaHQgPSB0aGlzLnN2Z0hlaWdodCAvIDU7CiAgICAgICAgaWYgKHRoaXMubm9kZWxpbmtkYXRhLm5vZGVzKSB7CiAgICAgICAgICB0aGlzLmluaXRHcmFwaCh0aGlzLm5vZGVsaW5rZGF0YSk7CiAgICAgICAgICB0aGlzLmluaXRUaHVtYm5haWwoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGFzeW5jIGNvbnZlcnRUb0ltYWdlKGV2ZW50LCBub2RlKSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgYXBpLmdldEltYWdlVXJsKHsgImRhdGFzZXROYW1lIjogdGhpcy4kc3RvcmUuc3RhdGUuZGF0YXNldE5hbWUsICJub2RlSWQiOiBub2RlLmlkIH0pOwogICAgICAgIGNvbnN0IGltYWdlVXJsID0gcmVzWyJkYXRhIl1bImltYWdlVXJsIl07CiAgICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IGQzLnNlbGVjdChldmVudC50YXJnZXQpOwogICAgICAgIGNvbnN0IHRhcmdldEJCb3ggPSB0YXJnZXRFbGVtZW50Lm5vZGUoKS5nZXRCQm94KCk7CiAgICAgICAgY29uc3QgdGFyZ2V0V2lkdGggPSB0YXJnZXRCQm94LndpZHRoOwogICAgICAgIGNvbnN0IHRhcmdldEhlaWdodCA9IHRhcmdldEJCb3guaGVpZ2h0OwogICAgICAgIGNvbnN0IHBhdHRlcm5JZCA9IGBwYXR0ZXJuLSR7bm9kZS5pZH1gOwogICAgICAgIGxldCBwYXR0ZXJuID0gZDMuc2VsZWN0KGAjJHtwYXR0ZXJuSWR9YCk7CiAgICAgICAgaWYgKHBhdHRlcm4uZW1wdHkoKSkgewogICAgICAgICAgY29uc3Qgc3ZnID0gZDMuc2VsZWN0KGAjbm9kZS1jbGFzc2ApOwogICAgICAgICAgbGV0IGRlZnMgPSBzdmcuc2VsZWN0KCJkZWZzIikuYXR0cigid2lkdGgiLCB0YXJnZXRXaWR0aCkuYXR0cigiaGVpZ2h0IiwgdGFyZ2V0SGVpZ2h0KTsKICAgICAgICAgIGlmIChkZWZzLmVtcHR5KCkpIHsKICAgICAgICAgICAgZGVmcyA9IHN2Zy5hcHBlbmQoImRlZnMiKS5hdHRyKCJ3aWR0aCIsIHRhcmdldFdpZHRoKS5hdHRyKCJoZWlnaHQiLCB0YXJnZXRIZWlnaHQpOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgcGF0dGVybiA9IGRlZnMuYXBwZW5kKCJwYXR0ZXJuIikKICAgICAgICAgICAgLmF0dHIoImlkIiwgcGF0dGVybklkKQogICAgICAgICAgICAuYXR0cigicGF0dGVyblVuaXRzIiwgIm9iamVjdEJvdW5kaW5nQm94IikKICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgMSkgLy8g5a695bqm5Li6IDEg6KGo56S655u45a+55LqO55uu5qCH5YWD57Sg55qE5a695bqmCiAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCAxKSAvLyDpq5jluqbkuLogMSDooajnpLrnm7jlr7nkuo7nm67moIflhYPntKDnmoTpq5jluqYKICAgICAgICAgICAgLmF0dHIoInBhdHRlcm5UcmFuc2Zvcm0iLCAidHJhbnNsYXRlKDEsIDEpIik7IC8vIOWQkeWPs+WSjOWQkeS4i+enu+WKqCAxMCDkuKrljZXkvY0KICAKICAgICAgICAgIGNvbnN0IGltYWdlID0gcGF0dGVybi5hcHBlbmQoImltYWdlIikKICAgICAgICAgICAgLmF0dHIoInhsaW5rOmhyZWYiLCBpbWFnZVVybCkKICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgNTgpCiAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCA1OCkKICAgICAgICAgICAgLmF0dHIoInByZXNlcnZlQXNwZWN0UmF0aW8iLCAieE1pZFlNaWQgc2xpY2UiKTsKICAgICAgICB9CiAgICAgICAgdGFyZ2V0RWxlbWVudAogICAgICAgICAgLmF0dHIoInIiLCAzMCkKICAgICAgICAgIC5hdHRyKCJmaWxsIiwgYHVybCgjcGF0dGVybi0ke25vZGUuaWR9KWApCiAgICAgICAgICAuYXR0cigic3Ryb2tlIiwgIiMwMDAiKSAvLyDorr7nva7ovrnmoYbpopzoibIKICAgICAgICAgIC5hdHRyKCJzdHJva2Utd2lkdGgiLCAyKTsgLy8g6K6+572u6L655qGG5a695bqmOwogIAogICAgICB9LAogICAgICBpbml0VGh1bWJuYWlsKCkgewogICAgICAgIGNvbnN0IHRodW1ibmFpbCA9IGQzLnNlbGVjdCh0aGlzLiRyZWZzLnRodW1ibmFpbCk7CiAgICAgICAgdGh1bWJuYWlsCiAgICAgICAgICAuYXR0cigid2lkdGgiLCB0aGlzLnRodW1ibmFpbFdpZHRoKQogICAgICAgICAgLmF0dHIoImhlaWdodCIsIHRoaXMudGh1bWJuYWlsSGVpZ2h0KQogICAgICAgICAgLmF0dHIoInZpZXdCb3giLCBgMCAwICR7dGhpcy5zdmdXaWR0aH0gJHt0aGlzLnN2Z0hlaWdodH1gKQogICAgICAgICAgLmF0dHIoInByZXNlcnZlQXNwZWN0UmF0aW8iLCAieE1pZFlNaWQgbWVldCIpCiAgICAgICAgICAuYXR0cigic3R5bGUiLCAicG9zaXRpb246IGFic29sdXRlOyBib3R0b206IDIwcHg7IGxlZnQ6IDIwcHg7IGJvcmRlcjogMXB4IHNvbGlkICNjY2M7IGJhY2tncm91bmQ6ICNmZmY7Iik7CiAgICAgIH0sCiAgICAgIHVwZGF0ZVRodW1ibmFpbCgpIHsKICAgICAgICBjb25zdCB0aGF0ID0gdGhpczsKICAgICAgICBjb25zdCB0aHVtYm5haWwgPSBkMy5zZWxlY3QodGhhdC4kcmVmcy50aHVtYm5haWwpOwogICAgICAgIHRodW1ibmFpbC5zZWxlY3RBbGwoIioiKS5yZW1vdmUoKTsKICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aHVtYm5haWwuYXBwZW5kKCJnIikKICAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCBgc2NhbGUoJHt0aGF0LnRodW1ibmFpbFdpZHRoIC8gdGhhdC5zdmdXaWR0aH0sICR7dGhhdC50aHVtYm5haWxIZWlnaHQgLyB0aGF0LnN2Z0hlaWdodH0pYCk7CiAgCiAgICAgICAgLy8gQ2xvbmUgbGVnZW5kIGFuZCBsaW5rIG5vZGVzCiAgICAgICAgY29uc3QgbGVnZW5kTm9kZSA9IGQzLnNlbGVjdCh0aGF0LiRyZWZzLmRhZykuc2VsZWN0KCJnLm5vZGVzIikubm9kZSgpLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICBjb25zdCBsaW5rTm9kZSA9IGQzLnNlbGVjdCh0aGF0LiRyZWZzLmRhZykuc2VsZWN0KCJnLmxpbmsiKS5ub2RlKCkuY2xvbmVOb2RlKHRydWUpOwogICAgICAgIGNvbnRhaW5lci5hcHBlbmQoKCkgPT4gbGVnZW5kTm9kZSk7CiAgICAgICAgY29udGFpbmVyLmFwcGVuZCgoKSA9PiBsaW5rTm9kZSk7CiAgCiAgICAgIH0sCiAgCiAgICAgIGluaXRHcmFwaChkYXRhKSB7CiAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGF0LnN2Z1dpZHRoOwogICAgICAgIGNvbnN0IGhlaWdodCA9IHRoYXQuc3ZnSGVpZ2h0OwogICAgICAgIGNvbnN0IHJlY2FsbCA9IGRhdGFbIm1ldHJpYyJdWydyZWNhbGwnXTsKICAgICAgICBjb25zdCBsaW5rcyA9IGRhdGEubGlua3MubWFwKGQgPT4gKHsgLi4uZCB9KSk7CiAgICAgICAgY29uc3Qgbm9kZXMgPSBkYXRhLm5vZGVzLm1hcChkID0+ICh7IC4uLmQgfSkpOwogIAogICAgICAgIC8vIOWcqOi/memHjOiOt+WPliBsaW5rcyB2YWx1ZSDkuK3nmoTmnIDlpKflgLzlkozmnIDlsI/lgLwKICAgICAgICBjb25zdCB2YWwgPSBsaW5rcy5tYXAoZCA9PiBkLnZhbHVlKTsKICAgICAgICBjb25zdCBtaW5WYWwgPSBNYXRoLm1pbiguLi52YWwpOwogICAgICAgIGNvbnN0IG1heFZhbCA9IE1hdGgubWF4KC4uLnZhbCk7CiAgCiAgICAgICAgLy8g5a6a5LmJ5b2S5LiA5YyW5Ye95pWwCiAgICAgICAgLy8g5a6a5LmJ5b2S5LiA5YyW5Ye95pWw77yM56Gu5L+d5pyA5bCP5YC85LiN5Li6IDAKICAgICAgICBjb25zdCBub3JtYWxpemUgPSAodmFsdWUpID0+IHsKICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRWYWx1ZSA9ICh2YWx1ZSAtIG1pblZhbCkgLyAobWF4VmFsIC0gbWluVmFsKTsKICAgICAgICAgIC8vIOWwhuW9kuS4gOWMluWAvOiMg+WbtOiwg+aVtOS4uiBbYSwgMV3vvIzlhbbkuK0gYSDkuLrnlaXlpKfkuo4gMCDnmoTmlbDlgLzvvIzkvovlpoIgMC4xCiAgICAgICAgICBjb25zdCBhID0gMC4xOwogICAgICAgICAgcmV0dXJuIDEwKihub3JtYWxpemVkVmFsdWUgKiAoMSAtIGEpICsgYSk7CiAgICAgICAgfTsKICAKICAgICAgICBjb25zdCBzaW11bGF0aW9uID0gZDMuZm9yY2VTaW11bGF0aW9uKG5vZGVzKQogICAgICAgICAgLmZvcmNlKCJsaW5rIiwgZDMuZm9yY2VMaW5rKGxpbmtzKS5pZChkID0+IGQuaWQpKQogICAgICAgICAgLy8gLmRpc3RhbmNlKGQgPT4gbm9ybWFsaXplKGQudmFsdWUpLzEwMDAwMCkpCiAgICAgICAgICAuZm9yY2UoImNoYXJnZSIsIGQzLmZvcmNlTWFueUJvZHkoKS5zdHJlbmd0aCgtMTApKQogICAgICAgICAgLmZvcmNlKCJjZW50ZXIiLCBkMy5mb3JjZUNlbnRlcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpLnN0cmVuZ3RoKDAuMykpCiAgICAgICAgICAvLyAuZm9yY2UoInJhZGlhbCIsIGQzLmZvcmNlUmFkaWFsKDUwMCwgd2lkdGggLyAyLCBoZWlnaHQgLyAyKS5zdHJlbmd0aCgwLjgpKQogICAgICAgICAgLy8gLmZvcmNlKCJ4IiwgZDMuZm9yY2VYKHdpZHRoIC8gMikuc3RyZW5ndGgoMC4wNSkpCiAgICAgICAgICAvLyAuZm9yY2UoInkiLCBkMy5mb3JjZVkoaGVpZ2h0IC8gMikuc3RyZW5ndGgoMC4wNSkpCiAgICAgICAgICAudmVsb2NpdHlEZWNheSh0aGlzLnZlbG9jaXR5RGVjYXkpCiAgICAgICAgICAub24oInRpY2siLCB0aWNrZWQpOwogIAogICAgICAgIGNvbnN0IHN2ZyA9IGQzLnNlbGVjdCh0aGlzLiRyZWZzLmRhZyk7CiAgICAgICAgc3ZnLnNlbGVjdEFsbCgiKiIpLnJlbW92ZSgpOwogIAogICAgICAgIHN2Zy5hdHRyKCJ2aWV3Qm94IiwgYDAgMCAke3dpZHRofSAke2hlaWdodH1gKQogICAgICAgICAgLmF0dHIoIndpZHRoIiwgIjEwMCUiKQogICAgICAgICAgLmF0dHIoImhlaWdodCIsICIxMDAlIikKICAgICAgICAgIC5hdHRyKCJwcmVzZXJ2ZUFzcGVjdFJhdGlvIiwgInhNaWRZTWlkIG1lZXQiKQogICAgICAgICAgLmF0dHIoInN0eWxlIiwgIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyIpCiAgICAgICAgICAuY2FsbChkMy56b29tKCkuc2NhbGVFeHRlbnQoWzAuNSwgOF0pLm9uKCJ6b29tIiwgem9vbWVkKSk7CiAgCiAgICAgICAgY29uc3QgY29sb3JNYXAgPSBkMy5zY2FsZU9yZGluYWwoKQogICAgICAgICAgLnJhbmdlKFsnI0ZGMDAwMCcsICcjQTREM0VFJywgJyNGRjdGNTAnLCAnIzMyQ0QzMiddKTsKICAgICAgICAgIGNvbnN0IGdyb3VwQ29sb3JNYXAgPSB7CiAgICAgICAgICAgIDA6ICIjRkYwMDAwIiwKICAgICAgICAgICAgMTogIiNBNEQzRUUiLAogICAgICAgICAgICAyOiAiIzMyQ0QzMiIsCiAgICAgICAgICAgIDM6ICIjRkY3RjUwIiwKICAgICAgICAgIH07CiAgCiAgICAgICAgY29uc3QgY29udGFpbmVyID0gc3ZnLmFwcGVuZCgiZyIpOwogICAgICAgIGNvbnN0IGxpbmsgPSBjb250YWluZXIuYXBwZW5kKCJnIikKICAgICAgICAgIC5hdHRyKCJjbGFzcyIsICJsaW5rIikKICAgICAgICAgIC5hdHRyKCJzdHJva2UiLCAiIzk5OSIpCiAgICAgICAgICAuYXR0cigic3Ryb2tlLW9wYWNpdHkiLCAwLjYpCiAgICAgICAgICAuc2VsZWN0QWxsKCJsaW5lIikKICAgICAgICAgIC5kYXRhKGxpbmtzKQogICAgICAgICAgLmpvaW4oImxpbmUiKQogICAgICAgICAgLmF0dHIoInN0cm9rZS13aWR0aCIsIGQgPT4gTWF0aC5zcXJ0KG5vcm1hbGl6ZShkLnZhbHVlKSkpCiAgICAgICAgICAuYXR0cigibWFya2VyLWVuZCIsICJ1cmwoI2Fycm93aGVhZCkiKQogICAgICAgICAgLmF0dHIoImZpbGwiLCBkID0+IGdyb3VwQ29sb3JNYXBbZC5ncm91cF0pOwogIAogICAgICAgIGNvbnN0IGJvcmRlciA9IGNvbnRhaW5lci5hcHBlbmQoImciKQogICAgICAgICAgLnNlbGVjdEFsbCgiY2lyY2xlIikKICAgICAgICAgIC5kYXRhKG5vZGVzKQogICAgICAgICAgLmpvaW4oImNpcmNsZSIpCiAgICAgICAgICAuYXR0cigiciIsIHYgPT4gewogICAgICAgICAgICBpZiAodi5ncm91cCA9PT0gMCkgewogICAgICAgICAgICAgIHJldHVybiAyMDsKICAgICAgICAgICAgfSBlbHNlIGlmICh2Lmdyb3VwID09PSAzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDE1OwogICAgICAgICAgICB9IGVsc2UgaWYgKHYuZ3JvdXAgPT09IDIpIHsKICAgICAgICAgICAgICByZXR1cm4gMTU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIDEyLjU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuYXR0cigiZmlsbCIsICJub25lIikKICAgICAgICAgIC5hdHRyKCJzdHJva2UiLCAibm9uZSIpCiAgICAgICAgICAuYXR0cigic3Ryb2tlLXdpZHRoIiwgMik7CiAgCiAgICAgICAgY29uc3Qgbm9kZSA9IGNvbnRhaW5lci5hcHBlbmQoImciKQogICAgICAgICAgLmF0dHIoImNsYXNzIiwgIm5vZGVzIikKICAgICAgICAgIC5hdHRyKCJpZCIsIGBub2RlLWNsYXNzYCkKICAgICAgICAgIC5hdHRyKCJzdHJva2UiLCAiI2ZmZiIpCiAgICAgICAgICAuYXR0cigic3Ryb2tlLXdpZHRoIiwgMC4yKQogICAgICAgICAgLnNlbGVjdEFsbCgiY2lyY2xlIikKICAgICAgICAgIC5kYXRhKG5vZGVzKQogICAgICAgICAgLmpvaW4oImNpcmNsZSIpCiAgICAgICAgICAuYXR0cigiciIsIHYgPT4gewogICAgICAgICAgICBpZiAodi5ncm91cCA9PT0gMCkgewogICAgICAgICAgICAgIHJldHVybiAxODsKICAgICAgICAgICAgfSBlbHNlIGlmICh2Lmdyb3VwID09PSAzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDEzOwogICAgICAgICAgICB9IGVsc2UgaWYgKHYuZ3JvdXAgPT09IDIpIHsKICAgICAgICAgICAgICByZXR1cm4gMTM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIDEwLjU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuYXR0cigiZmlsbCIsIGQgPT4gZ3JvdXBDb2xvck1hcFtkLmdyb3VwXSkKICAgICAgICAgIC5jYWxsKGQzLmRyYWcoKQogICAgICAgICAgICAub24oInN0YXJ0IiwgZHJhZ3N0YXJ0ZWQpCiAgICAgICAgICAgIC5vbigiZHJhZyIsIGRyYWdnZWQpCiAgICAgICAgICAgIC5vbigiZW5kIiwgZHJhZ2VuZGVkKSk7CiAgCiAgICAgICAgY29uc3QgbGFiZWxzID0gY29udGFpbmVyLmFwcGVuZCgiZyIpCiAgICAgICAgICAuYXR0cigiY2xhc3MiLCAibGFiZWxzIikKICAgICAgICAgIC5zZWxlY3RBbGwoInRleHQiKQogICAgICAgICAgLmRhdGEobm9kZXMpCiAgICAgICAgICAuam9pbigidGV4dCIpCiAgICAgICAgICAuYXR0cigiZHgiLCA2KQogICAgICAgICAgLmF0dHIoImR5IiwgIi4zNWVtIikKICAgICAgICAgIC5zdHlsZSgiZm9udC1zaXplIiwgIjEycHgiKSAgLy8g6K6+572u5a2X5L2T5aSn5bCPCiAgICAgICAgICAuYXR0cigic3Ryb2tlIiwgIndoaXRlIikKICAgICAgICAgIC5hdHRyKCJwYWludC1vcmRlciIsICJzdHJva2UiKQogICAgICAgICAgLnRleHQoZCA9PiB7CiAgICAgICAgICAgIGlmIChkLmdyb3VwID09PSAyIHx8IGQuZ3JvdXAgPT09IDMpIHsKICAgICAgICAgICAgICByZXR1cm4gYCR7ZC5pZH1gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgCiAgICAgICAgbm9kZS5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24gKGV2ZW50LCBkKSB7CiAgICAgICAgICBib3JkZXIuYXR0cigic3Ryb2tlIiwgKGIpID0+IGIuaWQgPT09IGQuaWQgPyAiIzYwOTZFNiIgOiAibm9uZSIpOwogICAgICAgIH0pCiAgICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24gKGV2ZW50LCBkKSB7CiAgICAgICAgICAgIGJvcmRlci5hdHRyKCJzdHJva2UiLCAibm9uZSIpOwogICAgICAgICAgfSk7CiAgCiAgICAgICAgbm9kZS5vbigiY2xpY2siLCBmdW5jdGlvbiAoZXZlbnQsIGQpIHsKICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbi1ib3gnKTsKICAgICAgICAgIGlmIChleGlzdGluZ0JveCkgewogICAgICAgICAgICBpZiAocGFyc2VJbnQoZXhpc3RpbmdCb3guZGF0YXNldC5ub2RlSWQpID09PSBwYXJzZUludChkLmlkKSkgewogICAgICAgICAgICAgIGV4aXN0aW5nQm94LnJlbW92ZSgpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBleGlzdGluZ0JveC5yZW1vdmUoKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBkMy5zZWxlY3QoImJvZHkiKS5hcHBlbmQoImRpdiIpCiAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsICJvcHRpb24tYm94IikKICAgICAgICAgICAgLmF0dHIoImRhdGEtbm9kZS1pZCIsIGQuaWQpCiAgICAgICAgICAgIC5zdHlsZSgicG9zaXRpb24iLCAiYWJzb2x1dGUiKQogICAgICAgICAgICAuc3R5bGUoImxlZnQiLCBgJHtldmVudC5wYWdlWCArIDEwfXB4YCkKICAgICAgICAgICAgLnN0eWxlKCJ0b3AiLCBgJHtldmVudC5wYWdlWSArIDEwfXB4YCkKICAgICAgICAgICAgLnN0eWxlKCJkaXNwbGF5IiwgImZsZXgiKQogICAgICAgICAgICAuc3R5bGUoImdhcCIsICI4cHgiKQogICAgICAgICAgICAuc3R5bGUoImJvcmRlciIsICIxcHggc29saWQgIzdGN0Y3RiIpCiAgICAgICAgICAgIC5zdHlsZSgiYmFja2dyb3VuZC1jb2xvciIsICIjRjdGN0Y3IikKICAgICAgICAgICAgLnN0eWxlKCJ3aWR0aCIsICI4NnB4IikKICAgICAgICAgICAgLnN0eWxlKCJoZWlnaHQiLCAiMjVweCIpCiAgICAgICAgICAgIC5zdHlsZSgicGFkZGluZyIsICIyLjVweCAwIikKICAgICAgICAgICAgLnN0eWxlKCJwYWRkaW5nLWxlZnQiLCAiOHB4IikKICAgICAgICAgICAgLnN0eWxlKCJib3JkZXItcmFkaXVzIiwgIjhweCIpCiAgICAgICAgICAgIC5zdHlsZSgiYWxpZ24taXRlbXMiLCAiY2VudGVyIikKICAgICAgICAgICAgLnN0eWxlKCJ6LWluZGV4IiwgMTAwMCk7CiAgICAgICAgICBvcHRpb25zLmFwcGVuZCgiZGl2IikKICAgICAgICAgICAgLnRleHQoIisiKQogICAgICAgICAgICAuc3R5bGUoImZvbnQtc2l6ZSIsICIyMHB4IikKICAgICAgICAgICAgLnN0eWxlKCJjb2xvciIsICIjNjc5RDQzIikKICAgICAgICAgICAgLnN0eWxlKCJib3JkZXItcmFkaXVzIiwgIjUwJSIpCiAgICAgICAgICAgIC5zdHlsZSgid2lkdGgiLCAiMjBweCIpCiAgICAgICAgICAgIC5zdHlsZSgiaGVpZ2h0IiwgIjIwcHgiKQogICAgICAgICAgICAuc3R5bGUoInRleHQtYWxpZ24iLCAiY2VudGVyIikKICAgICAgICAgICAgLnN0eWxlKCJsaW5lLWhlaWdodCIsICIyMHB4IikKICAgICAgICAgICAgLnN0eWxlKCJiYWNrZ3JvdW5kLWNvbG9yIiwgIiNENEUyQzgiKQogICAgICAgICAgICAub24oImNsaWNrIiwgKCkgPT4gY29uc29sZS5sb2coIlBsdXMgY2xpY2tlZCIsIGQpKTsKICAgICAgICAgIG9wdGlvbnMuYXBwZW5kKCJkaXYiKQogICAgICAgICAgICAudGV4dCgiLSIpCiAgICAgICAgICAgIC50ZXh0KCItIikKICAgICAgICAgICAgLnN0eWxlKCJmb250LXNpemUiLCAiMjBweCIpCiAgICAgICAgICAgIC5zdHlsZSgiYm9yZGVyLXJhZGl1cyIsICI1MCUiKQogICAgICAgICAgICAuc3R5bGUoIndpZHRoIiwgIjIwcHgiKQogICAgICAgICAgICAuc3R5bGUoImhlaWdodCIsICIyMHB4IikKICAgICAgICAgICAgLnN0eWxlKCJ0ZXh0LWFsaWduIiwgImNlbnRlciIpCiAgICAgICAgICAgIC5zdHlsZSgibGluZS1oZWlnaHQiLCAiMjBweCIpCiAgICAgICAgICAgIC5zdHlsZSgiYmFja2dyb3VuZC1jb2xvciIsICIjRDRFMkM4IikKICAgICAgICAgICAgLnN0eWxlKCJjb2xvciIsICIjNjc5RDQzIikKICAgICAgICAgICAgLm9uKCJjbGljayIsICgpID0+IGNvbnNvbGUubG9nKCJNaW51cyBjbGlja2VkIikpOwogICAgICAgICAgb3B0aW9ucy5hcHBlbmQoImRpdiIpCiAgICAgICAgICAgIC50ZXh0KCJBIikKICAgICAgICAgICAgLnN0eWxlKCJmb250LXNpemUiLCAiMTRweCIpCiAgICAgICAgICAgIC5zdHlsZSgiYm9yZGVyLXJhZGl1cyIsICI1MCUiKQogICAgICAgICAgICAuc3R5bGUoIndpZHRoIiwgIjIwcHgiKQogICAgICAgICAgICAuc3R5bGUoImhlaWdodCIsICIyMHB4IikKICAgICAgICAgICAgLnN0eWxlKCJ0ZXh0LWFsaWduIiwgImNlbnRlciIpCiAgICAgICAgICAgIC5zdHlsZSgiYmFja2dyb3VuZC1jb2xvciIsICIjRDRFMkM4IikKICAgICAgICAgICAgLnN0eWxlKCJjb2xvciIsICIjNjc5RDQzIikKICAgICAgICAgICAgLm9uKCJjbGljayIsICgpID0+IHRoYXQuY29udmVydFRvSW1hZ2UoZXZlbnQsIGQpKTsKICAKICAgICAgICAgIGQzLnNlbGVjdCgiYm9keSIpLm9uKCJjbGljayIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBpZiAoIWV2ZW50LnRhcmdldC5jbG9zZXN0KCcub3B0aW9uLWJveCcpICYmICFldmVudC50YXJnZXQuY2xvc2VzdCgnY2lyY2xlJykpIHsKICAgICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5vcHRpb24tYm94JykucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogIAogICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgfSk7CiAgCiAgICAgICAgbm9kZS5hcHBlbmQoInRpdGxlIikKICAgICAgICAgIC50ZXh0KGQgPT4gYElEOiAke2QuaWR9LCBEaXN0YW5jZTogJHtkLmRpc3RhbmNlfWApOwogIAogICAgICAgIHN2Zy5hcHBlbmQoInRleHQiKQogICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsIGB0cmFuc2xhdGUoNjAsIDUwKWApCiAgICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAic2Fucy1zZXJpZiIpCiAgICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgMTUpCiAgICAgICAgICAudGV4dChgUmVjYWxsOiAke3JlY2FsbH1gKTsKICAKICAgICAgICBjb25zdCBsZWdlbmQgPSBzdmcuYXBwZW5kKCJnIikKICAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCBgdHJhbnNsYXRlKDYwLCA2MClgKQogICAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgInNhbnMtc2VyaWYiKQogICAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsIDEwKTsKICAKICAgICAgICBjb25zdCB1bmlxdWVHcm91cHMgPSBbLi4ubmV3IFNldChub2Rlcy5tYXAoZCA9PiBkLmdyb3VwKSldOwogICAgICAgIGNvbnN0IGxlZ2VuZEl0ZW1zID0gbGVnZW5kLnNlbGVjdEFsbCgiZyIpCiAgICAgICAgICAuZGF0YSh1bmlxdWVHcm91cHMpCiAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoImciKQogICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsIChkLCBpKSA9PiBgdHJhbnNsYXRlKDAsJHtpICogMjB9KWApOwogICAgICAgIGxlZ2VuZEl0ZW1zLmFwcGVuZCgicmVjdCIpCiAgICAgICAgICAuYXR0cigid2lkdGgiLCAxOCkKICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCAxOCkKICAgICAgICAgIC5hdHRyKCJmaWxsIiwgZCA9PiBncm91cENvbG9yTWFwW2RdKTsKICAKICAgICAgICBsZWdlbmRJdGVtcy5hcHBlbmQoInRleHQiKQogICAgICAgICAgLmF0dHIoIngiLCAyNCkKICAgICAgICAgIC5hdHRyKCJ5IiwgOSkKICAgICAgICAgIC5hdHRyKCJkeSIsICIwLjM1ZW0iKQogICAgICAgICAgLnRleHQoZCA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZCA9PT0gMCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gInN0YXJ0IG5vZGUiOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAibm9ybWFsIG5vZGUiOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAiZ3Qmc2VhcmNoIGludGVyc2VjdGlvbiI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICJzZWFyY2ggb3RoZXIiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogIAogICAgICAgIGZ1bmN0aW9uIHRpY2tlZCgpIHsKICAgICAgICAgIGxpbmsKICAgICAgICAgICAgLmF0dHIoIngxIiwgZCA9PiBkLnNvdXJjZS54KQogICAgICAgICAgICAuYXR0cigieTEiLCBkID0+IGQuc291cmNlLnkpCiAgICAgICAgICAgIC5hdHRyKCJ4MiIsIGQgPT4gZC50YXJnZXQueCkKICAgICAgICAgICAgLmF0dHIoInkyIiwgZCA9PiBkLnRhcmdldC55KTsKICAgICAgICAgIG5vZGUKICAgICAgICAgICAgLmF0dHIoImN4IiwgZCA9PiBkLngpCiAgICAgICAgICAgIC5hdHRyKCJjeSIsIGQgPT4gZC55KTsKICAgICAgICAgIGJvcmRlcgogICAgICAgICAgICAuYXR0cigiY3giLCBkID0+IGQueCkKICAgICAgICAgICAgLmF0dHIoImN5IiwgZCA9PiBkLnkpOwogIAogICAgICAgICAgbGFiZWxzCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgZCA9PiBkLnggKyAyKQogICAgICAgICAgICAuYXR0cigieSIsIGQgPT4gZC55ICsgMC4zNSk7IC8vIOi/memHjOiuvue9ruaWh+acrOeahOS9jee9rgogIAogICAgICAgICAgdGhhdC51cGRhdGVUaHVtYm5haWwoKTsKICAgICAgICB9CiAgCiAgICAgICAgZnVuY3Rpb24gZHJhZ3N0YXJ0ZWQoZXZlbnQpIHsKICAgICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDAuMikucmVzdGFydCgpOwogICAgICAgICAgZXZlbnQuc3ViamVjdC5meCA9IGV2ZW50LnN1YmplY3QueDsKICAgICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC5zdWJqZWN0Lnk7CiAgICAgICAgfQogIAogICAgICAgIGZ1bmN0aW9uIGRyYWdnZWQoZXZlbnQpIHsKICAgICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBldmVudC54OwogICAgICAgICAgZXZlbnQuc3ViamVjdC5meSA9IGV2ZW50Lnk7CiAgICAgICAgfQogIAogICAgICAgIGZ1bmN0aW9uIGRyYWdlbmRlZChldmVudCkgewogICAgICAgICAgaWYgKCFldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMCk7CiAgICAgICAgICBldmVudC5zdWJqZWN0LmZ4ID0gbnVsbDsKICAgICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBudWxsOwogICAgICAgIH0KICAKICAgICAgICBmdW5jdGlvbiB6b29tZWQoZXZlbnQpIHsKICAgICAgICAgIGNvbnRhaW5lci5hdHRyKCJ0cmFuc2Zvcm0iLCBldmVudC50cmFuc2Zvcm0pOwogICAgICAgICAgdGhhdC51cGRhdGVUaHVtYm5haWwoKTsKICAgICAgICB9CiAgCiAgICAgIH0sCiAgICB9LAogICAgY29tcHV0ZWQ6IHsKICAgICAgLi4ubWFwU3RhdGUoewogICAgICAgIGRhdGFOb2RlbGluazogImRhdGFOb2RlTGluayIsCiAgICAgICAgcmV0cmlldmFsU2V0OiAicmV0cmlldmFsU2V0IiwKICAgICAgICBkYXRhc2V0TmFtZTogImRhdGFzZXROYW1lIiwKICAgICAgICBtb2RlbE5hbWU6ICJtb2RlbE5hbWUiLAogICAgICAgIHJldHJpZXZhbEluZm86ICJyZXRyaWV2YWxJbmZvIiwKICAgICAgICBpc0RvbmU6ICJpc0RvbmUiCiAgICAgIH0pLAogICAgfSwKICAgIHdhdGNoOiB7CiAgCiAgICAgIC8vIGRhdGFOb2RlbGluayhuZXdWYWwsIG9sZFZhbCkgewogICAgICAvLyAgIGNvbnNvbGUubG9nKCLlj6/ku6Xlrp7njrDmm7TmlrAiLG5ld1ZhbCk7CiAgICAgIC8vICAgaWYgKG5ld1ZhbCAhPT0gb2xkVmFsKSB7CiAgCiAgICAgIC8vICAgfQogICAgICAvLyB9CiAgCiAgICB9CiAgfTsKICA="},{"version":3,"sources":["HistoryView.vue"],"names":[],"mappings":";AAQA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA","file":"HistoryView.vue","sourceRoot":"src/views/MainView/RightMainView","sourcesContent":["<template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style><template>\n    <div class=\"node-link-main\">\n      <svg ref=\"dag\" class=\"dag-svg\"></svg>\n      <svg ref=\"thumbnail\" class=\"thumbnail-svg\"></svg>\n    </div>\n  </template>\n  \n  <script>\n  import * as d3 from \"d3\";\n  import { mapState } from \"vuex\";\n  import api from \"@/api/data\";\n  \n  export default {\n    name: \"NodeLinkView\",\n    components: {},\n    data() {\n      return {\n        nodelinkdata: {},\n        svgWidth: 0,  // 页面的宽度\n        svgHeight: 0,   // 页面高度\n        velocityDecay: 0.6,\n        thumbnailWidth: 0, // 缩略图宽度\n        thumbnailHeight: 0, // 缩略图高度\n      };\n    },\n    mounted() {\n      this.getViewSize();\n      this.nodelinkdata = this.$store.state.dataNodeLink;\n      console.log(\"请输出 link data 来看一下连接线的 data\",this.nodelinkdata);\n      this.initGraph(this.nodelinkdata);\n    },\n    methods: {\n      getViewSize() {\n        const dag = this.$refs.dag;\n        this.svgHeight = dag.clientHeight;\n        this.svgWidth = dag.clientWidth;\n        this.thumbnailWidth = this.svgWidth / 5;  // 缩略图宽度和高度分别为整个svg 的1/5\n        this.thumbnailHeight = this.svgHeight / 5;\n        if (this.nodelinkdata.nodes) {\n          this.initGraph(this.nodelinkdata);\n          this.initThumbnail();\n        }\n      },\n      async convertToImage(event, node) {\n        const res = await api.getImageUrl({ \"datasetName\": this.$store.state.datasetName, \"nodeId\": node.id });\n        const imageUrl = res[\"data\"][\"imageUrl\"];\n        const targetElement = d3.select(event.target);\n        const targetBBox = targetElement.node().getBBox();\n        const targetWidth = targetBBox.width;\n        const targetHeight = targetBBox.height;\n        const patternId = `pattern-${node.id}`;\n        let pattern = d3.select(`#${patternId}`);\n        if (pattern.empty()) {\n          const svg = d3.select(`#node-class`);\n          let defs = svg.select(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          if (defs.empty()) {\n            defs = svg.append(\"defs\").attr(\"width\", targetWidth).attr(\"height\", targetHeight);\n          }\n          const pattern = defs.append(\"pattern\")\n            .attr(\"id\", patternId)\n            .attr(\"patternUnits\", \"objectBoundingBox\")\n            .attr(\"width\", 1) // 宽度为 1 表示相对于目标元素的宽度\n            .attr(\"height\", 1) // 高度为 1 表示相对于目标元素的高度\n            .attr(\"patternTransform\", \"translate(1, 1)\"); // 向右和向下移动 10 个单位\n  \n          const image = pattern.append(\"image\")\n            .attr(\"xlink:href\", imageUrl)\n            .attr(\"width\", 58)\n            .attr(\"height\", 58)\n            .attr(\"preserveAspectRatio\", \"xMidYMid slice\");\n        }\n        targetElement\n          .attr(\"r\", 30)\n          .attr(\"fill\", `url(#pattern-${node.id})`)\n          .attr(\"stroke\", \"#000\") // 设置边框颜色\n          .attr(\"stroke-width\", 2); // 设置边框宽度;\n  \n      },\n      initThumbnail() {\n        const thumbnail = d3.select(this.$refs.thumbnail);\n        thumbnail\n          .attr(\"width\", this.thumbnailWidth)\n          .attr(\"height\", this.thumbnailHeight)\n          .attr(\"viewBox\", `0 0 ${this.svgWidth} ${this.svgHeight}`)\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"position: absolute; bottom: 20px; left: 20px; border: 1px solid #ccc; background: #fff;\");\n      },\n      updateThumbnail() {\n        const that = this;\n        const thumbnail = d3.select(that.$refs.thumbnail);\n        thumbnail.selectAll(\"*\").remove();\n        const container = thumbnail.append(\"g\")\n          .attr(\"transform\", `scale(${that.thumbnailWidth / that.svgWidth}, ${that.thumbnailHeight / that.svgHeight})`);\n  \n        // Clone legend and link nodes\n        const legendNode = d3.select(that.$refs.dag).select(\"g.nodes\").node().cloneNode(true);\n        const linkNode = d3.select(that.$refs.dag).select(\"g.link\").node().cloneNode(true);\n        container.append(() => legendNode);\n        container.append(() => linkNode);\n  \n      },\n  \n      initGraph(data) {\n        const that = this;\n        const width = that.svgWidth;\n        const height = that.svgHeight;\n        const recall = data[\"metric\"]['recall'];\n        const links = data.links.map(d => ({ ...d }));\n        const nodes = data.nodes.map(d => ({ ...d }));\n  \n        // 在这里获取 links value 中的最大值和最小值\n        const val = links.map(d => d.value);\n        const minVal = Math.min(...val);\n        const maxVal = Math.max(...val);\n  \n        // 定义归一化函数\n        // 定义归一化函数，确保最小值不为 0\n        const normalize = (value) => {\n          const normalizedValue = (value - minVal) / (maxVal - minVal);\n          // 将归一化值范围调整为 [a, 1]，其中 a 为略大于 0 的数值，例如 0.1\n          const a = 0.1;\n          return 10*(normalizedValue * (1 - a) + a);\n        };\n  \n        const simulation = d3.forceSimulation(nodes)\n          .force(\"link\", d3.forceLink(links).id(d => d.id))\n          // .distance(d => normalize(d.value)/100000))\n          .force(\"charge\", d3.forceManyBody().strength(-10))\n          .force(\"center\", d3.forceCenter(width / 2, height / 2).strength(0.3))\n          // .force(\"radial\", d3.forceRadial(500, width / 2, height / 2).strength(0.8))\n          // .force(\"x\", d3.forceX(width / 2).strength(0.05))\n          // .force(\"y\", d3.forceY(height / 2).strength(0.05))\n          .velocityDecay(this.velocityDecay)\n          .on(\"tick\", ticked);\n  \n        const svg = d3.select(this.$refs.dag);\n        svg.selectAll(\"*\").remove();\n  \n        svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n          .attr(\"width\", \"100%\")\n          .attr(\"height\", \"100%\")\n          .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n          .attr(\"style\", \"max-width: 100%; height: auto;\")\n          .call(d3.zoom().scaleExtent([0.5, 8]).on(\"zoom\", zoomed));\n  \n        const colorMap = d3.scaleOrdinal()\n          .range(['#FF0000', '#A4D3EE', '#FF7F50', '#32CD32']);\n          const groupColorMap = {\n            0: \"#FF0000\",\n            1: \"#A4D3EE\",\n            2: \"#32CD32\",\n            3: \"#FF7F50\",\n          };\n  \n        const container = svg.append(\"g\");\n        const link = container.append(\"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"stroke\", \"#999\")\n          .attr(\"stroke-opacity\", 0.6)\n          .selectAll(\"line\")\n          .data(links)\n          .join(\"line\")\n          .attr(\"stroke-width\", d => Math.sqrt(normalize(d.value)))\n          .attr(\"marker-end\", \"url(#arrowhead)\")\n          .attr(\"fill\", d => groupColorMap[d.group]);\n  \n        const border = container.append(\"g\")\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 20;\n            } else if (v.group === 3) {\n              return 15;\n            } else if (v.group === 2) {\n              return 15;\n            } else {\n              return 12.5;\n            }\n          })\n          .attr(\"fill\", \"none\")\n          .attr(\"stroke\", \"none\")\n          .attr(\"stroke-width\", 2);\n  \n        const node = container.append(\"g\")\n          .attr(\"class\", \"nodes\")\n          .attr(\"id\", `node-class`)\n          .attr(\"stroke\", \"#fff\")\n          .attr(\"stroke-width\", 0.2)\n          .selectAll(\"circle\")\n          .data(nodes)\n          .join(\"circle\")\n          .attr(\"r\", v => {\n            if (v.group === 0) {\n              return 18;\n            } else if (v.group === 3) {\n              return 13;\n            } else if (v.group === 2) {\n              return 13;\n            } else {\n              return 10.5;\n            }\n          })\n          .attr(\"fill\", d => groupColorMap[d.group])\n          .call(d3.drag()\n            .on(\"start\", dragstarted)\n            .on(\"drag\", dragged)\n            .on(\"end\", dragended));\n  \n        const labels = container.append(\"g\")\n          .attr(\"class\", \"labels\")\n          .selectAll(\"text\")\n          .data(nodes)\n          .join(\"text\")\n          .attr(\"dx\", 6)\n          .attr(\"dy\", \".35em\")\n          .style(\"font-size\", \"12px\")  // 设置字体大小\n          .attr(\"stroke\", \"white\")\n          .attr(\"paint-order\", \"stroke\")\n          .text(d => {\n            if (d.group === 2 || d.group === 3) {\n              return `${d.id}`;\n            } else {\n              return \"\";\n            }\n          });\n  \n        node.on(\"mouseover\", function (event, d) {\n          border.attr(\"stroke\", (b) => b.id === d.id ? \"#6096E6\" : \"none\");\n        })\n          .on(\"mouseout\", function (event, d) {\n            border.attr(\"stroke\", \"none\");\n          });\n  \n        node.on(\"click\", function (event, d) {\n          const existingBox = document.querySelector('.option-box');\n          if (existingBox) {\n            if (parseInt(existingBox.dataset.nodeId) === parseInt(d.id)) {\n              existingBox.remove();\n              return;\n            }\n            existingBox.remove();\n          }\n          const options = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"option-box\")\n            .attr(\"data-node-id\", d.id)\n            .style(\"position\", \"absolute\")\n            .style(\"left\", `${event.pageX + 10}px`)\n            .style(\"top\", `${event.pageY + 10}px`)\n            .style(\"display\", \"flex\")\n            .style(\"gap\", \"8px\")\n            .style(\"border\", \"1px solid #7F7F7F\")\n            .style(\"background-color\", \"#F7F7F7\")\n            .style(\"width\", \"86px\")\n            .style(\"height\", \"25px\")\n            .style(\"padding\", \"2.5px 0\")\n            .style(\"padding-left\", \"8px\")\n            .style(\"border-radius\", \"8px\")\n            .style(\"align-items\", \"center\")\n            .style(\"z-index\", 1000);\n          options.append(\"div\")\n            .text(\"+\")\n            .style(\"font-size\", \"20px\")\n            .style(\"color\", \"#679D43\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .on(\"click\", () => console.log(\"Plus clicked\", d));\n          options.append(\"div\")\n            .text(\"-\")\n            .text(\"-\")\n            .style(\"font-size\", \"20px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"line-height\", \"20px\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => console.log(\"Minus clicked\"));\n          options.append(\"div\")\n            .text(\"A\")\n            .style(\"font-size\", \"14px\")\n            .style(\"border-radius\", \"50%\")\n            .style(\"width\", \"20px\")\n            .style(\"height\", \"20px\")\n            .style(\"text-align\", \"center\")\n            .style(\"background-color\", \"#D4E2C8\")\n            .style(\"color\", \"#679D43\")\n            .on(\"click\", () => that.convertToImage(event, d));\n  \n          d3.select(\"body\").on(\"click\", function (event) {\n            if (!event.target.closest('.option-box') && !event.target.closest('circle')) {\n              d3.selectAll('.option-box').remove();\n            }\n          });\n  \n          event.stopPropagation();\n        });\n  \n        node.append(\"title\")\n          .text(d => `ID: ${d.id}, Distance: ${d.distance}`);\n  \n        svg.append(\"text\")\n          .attr(\"transform\", `translate(60, 50)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 15)\n          .text(`Recall: ${recall}`);\n  \n        const legend = svg.append(\"g\")\n          .attr(\"transform\", `translate(60, 60)`)\n          .attr(\"font-family\", \"sans-serif\")\n          .attr(\"font-size\", 10);\n  \n        const uniqueGroups = [...new Set(nodes.map(d => d.group))];\n        const legendItems = legend.selectAll(\"g\")\n          .data(uniqueGroups)\n          .enter().append(\"g\")\n          .attr(\"transform\", (d, i) => `translate(0,${i * 20})`);\n        legendItems.append(\"rect\")\n          .attr(\"width\", 18)\n          .attr(\"height\", 18)\n          .attr(\"fill\", d => groupColorMap[d]);\n  \n        legendItems.append(\"text\")\n          .attr(\"x\", 24)\n          .attr(\"y\", 9)\n          .attr(\"dy\", \"0.35em\")\n          .text(d => {\n                if (d === 0) {\n                  return \"start node\";\n                } else if (d === 1) {\n                  return \"normal node\";\n                } else if (d === 2) {\n                  return \"gt&search intersection\";\n                } else if (d === 3) {\n                  return \"search other\";\n                }\n              });\n  \n        function ticked() {\n          link\n            .attr(\"x1\", d => d.source.x)\n            .attr(\"y1\", d => d.source.y)\n            .attr(\"x2\", d => d.target.x)\n            .attr(\"y2\", d => d.target.y);\n          node\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n          border\n            .attr(\"cx\", d => d.x)\n            .attr(\"cy\", d => d.y);\n  \n          labels\n            .attr(\"x\", d => d.x + 2)\n            .attr(\"y\", d => d.y + 0.35); // 这里设置文本的位置\n  \n          that.updateThumbnail();\n        }\n  \n        function dragstarted(event) {\n          if (!event.active) simulation.alphaTarget(0.2).restart();\n          event.subject.fx = event.subject.x;\n          event.subject.fy = event.subject.y;\n        }\n  \n        function dragged(event) {\n          event.subject.fx = event.x;\n          event.subject.fy = event.y;\n        }\n  \n        function dragended(event) {\n          if (!event.active) simulation.alphaTarget(0);\n          event.subject.fx = null;\n          event.subject.fy = null;\n        }\n  \n        function zoomed(event) {\n          container.attr(\"transform\", event.transform);\n          that.updateThumbnail();\n        }\n  \n      },\n    },\n    computed: {\n      ...mapState({\n        dataNodelink: \"dataNodeLink\",\n        retrievalSet: \"retrievalSet\",\n        datasetName: \"datasetName\",\n        modelName: \"modelName\",\n        retrievalInfo: \"retrievalInfo\",\n        isDone: \"isDone\"\n      }),\n    },\n    watch: {\n  \n      // dataNodelink(newVal, oldVal) {\n      //   console.log(\"可以实现更新\",newVal);\n      //   if (newVal !== oldVal) {\n  \n      //   }\n      // }\n  \n    }\n  };\n  </script>\n  \n  <style scoped lang=\"scss\">\n  .node-link-main {\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n    position: relative;\n  \n    .dag-svg {\n      height: 100%;\n      width: 100%;\n    }\n  \n    .thumbnail-svg {\n      position: absolute;\n      bottom: 20px;\n      left: 20px;\n      border: 1px solid #ccc;\n      background: #fff;\n    }\n  }\n  \n  .option-box {\n    border: 1px solid #F7F7F7;\n    background-color: #F7F7F7;\n    padding: 5px;\n    position: absolute;\n    z-index: 1000;\n  \n    div {\n      margin: 2px 0;\n      cursor: pointer;\n    }\n  \n    div:hover {\n      background-color: #f0f0f0;\n    }\n  }\n  \n  .option-button {\n    padding: 5px 10px;\n    border: 1px solid #000;\n    border-radius: 5px;\n    cursor: pointer;\n    background-color: #f0f0f0;\n    font-size: 14px;\n    font-family: Arial, sans-serif;\n    color: red;\n  }\n  \n  .option-button:hover {\n    background-color: #e0e0e0;\n  }\n  </style>"]}]}